apiVersion: tool@v1
tool: "altdns"
version: "1.0.2"
description: "DNS Altmutations"

io:
  inputKind: domain
  produces:
    - event_type: "http.domain"
      schema: "events/domain@v1"

constraints:
  max_batch_size: 1

contracts:
  resources:               # static blobs from catalog/tenant
    - slot: commonPrefixes               # logical name the adapter knows
      required: false
      media: text                        # text | json | bin
      maxBytes: 10485760
      description: "Optional curated wordlist of common subdomain prefixes."

  context:                 # plan-time blobs produced by Context Providers
    - slot: tenantPrefixes
      required: false
      media: json
      shape: { prefixes: ["string"] }    # human/docs only; linter can do shallow checks
      maxBytes: 5242880
      description: "Prefixes learned from tenant DNS."

params:                                            # NEW: declared flags/params contract
  - name: useCommonPrefixes
    type: boolean
    required: false
    default: true
    description: "If true, use the common prefixes resource as candidates."

  - name: useTenantPrefixes
    type: boolean
    required: false
    default: true
    description: "If true, use tenant-learned prefixes from context provider."
  
  - name: useEmbeddedPrefixes
    type: boolean
    required: false
    default: true
    description: "If true, use embedded small list of prefixes"

  - name: maxCandidatesPerBase
    type: integer
    default: 5000
    description: "Maximum candidate prefixes to try per base domain."
    maximum: 20000

  - name: resolutionTimeoutMs
    type: integer
    required: false
    default: 2000
    description: "Timeout for DNS queries in milliseconds."

runtime:
  image: "altdns:1.0.3"
  image_digest: "sha256:REPLACE_WITH_HTTPX_DIGEST"
  cpu_millis: 500
  memory_mb: 256

build:
  dockerfile: "Dockerfile"
  context: "."